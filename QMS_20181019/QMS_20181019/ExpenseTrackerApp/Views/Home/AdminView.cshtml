
<style>
    .k-grid .k-alt {
        background-color: linen; /* specify the alternate background-color */
    }

    .k-window.k-confirm .k-content {
        padding: 50px 50px;
    }

    .btn-success {
        color : black;
    }
</style>
<div class="container">
    <button class="btn btn-primary" id="btnAdd" data-toggle="modal" data-target="#addModal"><span class="k-icon k-i-plus"></span>Add New Record</button>
    <br />
    <table id="datatable"></table>
    <br />
    <div id="addModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add User</h4>
                </div>
                <div class="modal-body">
                    <div class="row">

                        <div class="form-group col-md-4">
                            <label for="" class="control-label">User Name</label>
                            <input type="text" id="txtUserName" maxlength="50" class="form-control" name="UserName" required>
                            <span class="k-invalid-msg" data-for="txtUserName"></span>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="" class="control-label">Password</label>
                            <input type="text" id="txtPassword" maxlength="50" class="form-control" name="Password" required>
                            <span class="k-invalid-msg" data-for="txtPassword"></span>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="" class="control-label">Role</label>
                            <input data-message="Please Select Value" name="Role" class="form-control" id="ddlRoles" required>
                            <span class="k-invalid-msg" data-for="ddlRoles"></span>
                        </div>

                    </div>
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label for="" class="control-label">First Name</label>
                            <input type="text" id="txtFirstName" maxlength="50" name="First Name" class="form-control" required>
                            <span class="k-invalid-msg" data-for="txtFirstName"></span>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="" class="control-label">Last Name</label>
                            <input type="text" id="txtLastName" maxlength="50" name="Last Name" class="form-control" required>
                            <span class="k-invalid-msg" data-for="txtLastName"></span>
                        </div>

                        <div class="form-group col-md-4">
                            <label for="" class="control-label">Phone Number</label>
                            <input type="number" id="txtPhoneNumber" maxlength="15" name="Phone Number" class="form-control" required>
                            <span class="k-invalid-msg" data-for="txtPhoneNumber"></span>
                        </div>

                    </div>
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label for="" class="control-label">Email</label>
                            <input type="email" id="txtEmail" maxlength="50" name="Email" class="form-control" required>
                            <span class="k-invalid-msg" data-for="txtEmail"></span>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="" class="control-label">Secret Question</label>
                            <input data-message="Please Select Value" name="Secret Question" class="form-control" id="ddlSecretQuestions" required>
                            <span class="k-invalid-msg" data-for="ddlSecretQuestions"></span>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="" class="control-label">Secret Answer</label>
                            <input type="text" id="txtSecretAnswer" maxlength="50" name="Secret Answer" class="form-control" required>
                            <span class="k-invalid-msg" data-for="txtSecretAnswer"></span>
                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="Save" class="btn btn-success">Add</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>
</div>
<script id="EditUser" type="text/x-kendo-template">
    <div class="panel-body" id="EditForm">

        <div class="row">

            <div class="form-group col-md-4">
                <label for="" class="control-label">User Name</label>
                <input type="text" id="etxtUserName" maxlength="50" class="form-control" name="UserName" data-bind="value:UserName" required>
                <span class="k-invalid-msg" data-for="etxtUserName"></span>
            </div>
            <div class="form-group col-md-4">
                <label for="" class="control-label">Password</label>
                <input type="text" id="etxtPassword" maxlength="50" class="form-control" data-bind="value:Password" name="Password" required>
                <span class="k-invalid-msg" data-for="etxtPassword"></span>
            </div>
            <div class="form-group col-md-4">
                <label for="" class="control-label">Role</label>
                <input data-message="Please Select Value" name="Role" class="form-control" data-bind="value:RoleName" id="eddlRoles" required>
                <span class="k-invalid-msg" data-for="eddlRoles"></span>
            </div>

        </div>
        <div class="row">
            <div class="form-group col-md-4">
                <label for="" class="control-label">First Name</label>
                <input type="text" id="etxtFirstName" maxlength="50" name="First Name" data-bind="value:FirstName" class="form-control" required>
                <span class="k-invalid-msg" data-for="etxtFirstName"></span>
            </div>
            <div class="form-group col-md-4">
                <label for="" class="control-label">Last Name</label>
                <input type="text" id="etxtLastName" maxlength="50" name="Last Name" data-bind="value:LastName" class="form-control" required>
                <span class="k-invalid-msg" data-for="etxtLastName"></span>
            </div>

            <div class="form-group col-md-4">
                <label for="" class="control-label">Phone Number</label>
                <input type="number" id="etxtPhoneNumber" maxlength="15" data-bind="value:PhoneNumber" name="Phone Number" class="form-control" required>
                <span class="k-invalid-msg" data-for="etxtPhoneNumber"></span>
            </div>

        </div>
        <div class="row">
            <div class="form-group col-md-4">
                <label for="" class="control-label">Email</label>
                <input type="email" id="etxtEmail" maxlength="50" name="Email" data-bind="value:Email" class="form-control" required>
                <span class="k-invalid-msg" data-for="txtEmail"></span>
            </div>
            <div class="form-group col-md-4">
                <label for="" class="control-label">Secret Question</label>
                <input data-message="Please Select Value" name="Secret Question" data-bind="value:SecurityQuestion" class="form-control" id="eddlSecretQuestions" required>
                <span class="k-invalid-msg" data-for="eddlSecretQuestions"></span>
            </div>
            <div class="form-group col-md-4">
                <label for="" class="control-label">Secret Answer</label>
                <input type="text" id="etxtSecretAnswer" maxlength="50" name="Secret Answer" data-bind="value:SecurityAnswer" class="form-control" required>
                <span class="k-invalid-msg" data-for="etxtSecretAnswer"></span>
            </div>


        </div>



    </div>
</script>
@*<script type="text/x-kendo-template" id="toolbartemplate">


       <a class="k-button k-button-icontext k-grid-excel" id="btnExcelExport" style="float:right"><span class="k-icon k-i-file-excel"></span> Export to Excel</a>
       <a class="k-button k-button-icontext" id="btnAdd" style="float:right"><span class="k-icon k-i-plus"></span>Add New Record</a>
    </script>*@

<script type="text/javascript">

    $(document).ready(function () {
        // ClearData();
        function ClearData() {
            $('#txtUserName').val('');
            $('#txtPassword').val('');
            $('#txtFirstName').val('');
            $('#txtLastName').val('');
            $("#ddlRoles").data("kendoDropDownList").select(0);
            $('#txtPhoneNumber').val('');
            $('#txtEmail').val('');
            $('#txtSecretAnswer').val('');
            $("#ddlSecretQuestions").data("kendoDropDownList").select(0);
        }
        function Add() {
            ClearData();
            $('#addModal').modal('show');
        }

        $("#ddlSecretQuestions").kendoDropDownList({
            optionLabel: "Select Secret Question",
            filter: "startswith",
            dataTextField: "SQues",
            dataValueField: "SQuesID",
            dataSource: {
                serverFiltering: false,
                transport: {
                    read: {
                        url: '@Url.Action("GetSecretQuestion", "Home")',
                        dataType: "json",
                    },
                    schema: {
                        model: {
                            fields: {
                                CategoryID: { type: "string" },
                                CategoryName: { type: "string" }
                            },
                        },
                    },
                },
            }
        }).data("kendoDropDownList");

        $("#ddlRoles").kendoDropDownList({
            optionLabel: "Select Role",
            filter: "startswith",
            dataTextField: "RoleName",
            dataValueField: "RoleID",
            dataSource: {
                serverFiltering: false,
                transport: {
                    read: {
                        url: '@Url.Action("GetRoles", "Home")',
                        dataType: "json",
                    },
                    schema: {
                        model: {
                            fields: {
                                CategoryID: { type: "string" },
                                CategoryName: { type: "string" }
                            },
                        },
                    },
                },
            }
        }).data("kendoDropDownList");

        $('#Save').click(function () {
            var validator = $("#addModal").kendoValidator().data("kendoValidator");
            if (validator.validate()) {
                $("#loader").show();
                var UserName = $('#txtUserName').val();
                var Password = $('#txtPassword').val();
                var FirstName = $('#txtFirstName').val();
                var LastName = $('#txtLastName').val();
                var Role = $('#ddlRoles').val();
                var PhoneNumber = $('#txtPhoneNumber').val();
                var Email = $('#txtEmail').val();
                var SecretQuestion = $('#ddlSecretQuestions').val();
                var SecretAnswer = $('#txtSecretAnswer').val();

                var model = {

                    "UserName": UserName,
                    "Password": Password,
                    "FirstName": FirstName,
                    "LastName": LastName,
                    "Role": Role,
                    "PhoneNumber": PhoneNumber,
                    "Email": Email,
                    "SecretQuestion": SecretQuestion,
                    "SecretAnswer": SecretAnswer

                };
                console.log(model);
                $.ajax(
                 {
                     url: '@Url.Action("AddUser", "Home")',
                     data: JSON.stringify(model),
                     type: 'POST',
                     contentType: 'application/json; charset=utf-8',
                     //dataType:"text",
                     success: function (data) {
                         //alert("data");
                         //alert(data);
                         $("#loader").hide();
                         if (data == 1 || data == -1) {
                             $('#addModal').modal('hide');
                             new PNotify({
                                 title: 'Success!',
                                 text: 'Record has been Inserted.',
                                 type: 'success'
                             });
                             ClearData();
                             $("#datatable").data("kendoGrid").dataSource.read();
                         }
                         else {
                             $('#addModal').modal('hide');
                             new PNotify({
                                 title: 'Error!',
                                 text: 'Record Insertion Failed.',
                                 type: 'error'
                             });
                         }

                     }

                 }
      );
            }

        });

        function onRequestEdit(arg) {
            console.log(arg.model);
            var model = arg.model;
            var validator = $("#EditForm").kendoValidator().data("kendoValidator");
            if (validator.validate()) {
                $("#loader").show();
                var UserName = $('#etxtUserName').val();
                var Password = $('#etxtPassword').val();
                var FirstName = $('#etxtFirstName').val();
                var LastName = $('#etxtLastName').val();
                var RoleName = $('#eddlRoles').val();
                var PhoneNumber = $('#etxtPhoneNumber').val();
                var Email = $('#etxtEmail').val();
                var SecretQuestion = $('#eddlSecretQuestions').val();
                var SecretAnswer = $('#etxtSecretAnswer').val();

                var Editmodel = {

                    "UserName": UserName,
                    "Password": Password,
                    "FirstName": FirstName,
                    "LastName": LastName,
                    "RoleName": RoleName,
                    "PhoneNumber": PhoneNumber,
                    "Email": Email,
                    "SecretQuestion": SecretQuestion,
                    "SecretAnswer": SecretAnswer,
                    "UserId":model.UserId
                };

                $.ajax({
                    url: '@Url.Action("EditUser", "Home")',
                    data: JSON.stringify(Editmodel),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {

                        $("#loader").hide();

                        if (data == 1 || data == -1) {
                            new PNotify({
                                title: 'Success!',
                                text: 'Record has been Updated.',
                                type: 'success'
                            });
                            $("#datatable").data("kendoGrid").dataSource.read();
                        }
                    }
                });
            }

        }

        var dataSource = new kendo.data.DataSource({
            transport: {

                read: {
                    url: '@Url.Action("ListUsers", "Home")',
                    dataType: "json" // "jsonp" is required for cross-domain requests; use "json" for same-domain requests
                }
            },
            pageSize: 16
        });

        $("#datatable").kendoGrid({
            toolbar: $("#toolbartemplate").html(),
            theme: "Bootstrap",
            excel: {
                allPages: true,
                fileName: "Sales.xlsx"
            },
            dataSource: dataSource,
            dataBound: function () {
                var grid = $("#datatable").data("kendoGrid");


            },
            scrollable: true,
            sortable: true,
            pageable: true,
            autoBind: true,
            resizable: true,
            filterable: true,
            columns: [


            {
                field: "UserId",
                hidden: true

            }, {
                field: "UserName",
                title: "User Name",
                width: 100
            }, {
                field: "FirstName",
                title: "First Name",
                width: 100,

            }, {
                field: "LastName",
                title: "Last Name",
                width: 100,

            },
            {
                field: "RoleName",
                title: "Role",
                width: 50

            }, {
                field: "Password",
                hidden: true

            }, {
                field: "Email",
                hidden: true

            }, {
                field: "PhoneNumber",
                hidden: true

            }, {
                field: "SecurityQuestion",
                hidden: true

            }, {
                field: "SecurityAnswer",
                hidden: true

            }, {
                command: [
                { name: "edit", text: "", template: "<a class='k-button k-grid-edit btn' href=''><i class='material-icons md-18'>mode_edit</i></a>" },
                {
                    name: "Delete", text: "", template: "<a class='k-button k-grid-Delete' href=''><i class='material-icons md-18'>delete</i></a>", click: function (e) {

                        e.preventDefault(); //prevent page scroll reset

                        var tr = $(e.target).closest("tr"); //get the row for deletion
                        var data = this.dataItem(tr); //get the row data so it can be referred later

                        kendo.confirm("Are you sure you want to delete this sale record?").then(function () {
                            var Deletemodel = {
                                "UserId": data.UserId
                            }
                            //$("#loader").show();

                            $.ajax({
                                url: '@Url.Action("DeleteUser", "Home")',
                                data: JSON.stringify(Deletemodel),
                                type: 'POST',
                                contentType: 'application/json; charset=utf-8',
                                success: function (data) {

                                    //$("#loader").hide();

                                    if (data == 1 || data == -1) {
                                        new PNotify({
                                            title: 'Success!',
                                            text: 'Record has been Deleted.',
                                            type: 'success'
                                        });
                                        $("#datatable").data("kendoGrid").dataSource.read();
                                    }
                                }
                            });
                        }, function () {
                            //kendo.alert("You chose to Cancel action.");
                        });
                    }
                }
                ], title: "Action", width: "118px"
            }],

            editable: {
                mode: "popup",
                template: $("#EditUser").html(),
                //update: true,
                window: {
                    draggable: false
                }
            },
            destroy: function (e) {

                console.log(e);
            },
            edit: function (e) {
                $("#eddlSecretQuestions").kendoDropDownList({
                    optionLabel: "Select Secret Question",
                    filter: "startswith",
                    dataTextField: "SQues",
                    dataValueField: "SQues",
                    dataSource: {
                        serverFiltering: false,
                        transport: {
                            read: {
                                url: '@Url.Action("GetSecretQuestion", "Home")',
                                dataType: "json",
                            },
                            schema: {
                                model: {
                                    fields: {
                                        CategoryID: { type: "string" },
                                        CategoryName: { type: "string" }
                                    },
                                },
                            },
                        },
                    }
                }).data("kendoDropDownList");

                $("#eddlRoles").kendoDropDownList({
                    optionLabel: "Select Role",
                    filter: "startswith",
                    dataTextField: "RoleName",
                    dataValueField: "RoleName",
                    dataSource: {
                        serverFiltering: false,
                        transport: {
                            read: {
                                url: '@Url.Action("GetRoles", "Home")',
                                dataType: "json",
                            },
                            schema: {
                                model: {
                                    fields: {
                                        CategoryID: { type: "string" },
                                        CategoryName: { type: "string" }
                                    },
                                },
                            },
                        },
                    }
                }).data("kendoDropDownList");
                //var val = $('#eFlag').val();
                var updateBtn = e.container.find(".k-grid-update");
                updateBtn.removeClass("k-grid-update"); //removing this class will prevent the grid from saving on click
                updateBtn.click(function () {
                    onRequestEdit(e); //call the function you wish

                });

            }

        });

    });




</script>
